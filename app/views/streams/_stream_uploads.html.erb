<div class="card">
  <div class="card-header d-flex justify-content-between">
    <h3 class="h5 align-self-center mb-0">Files <%= number_with_delimiter stream.files.size %> | Size <%= number_to_human_size stream.files.sum(:byte_size) %></h3>
    <%= link_to 'Upload file', new_organization_upload_path(@organization), class: 'btn btn-primary' %>
  </div>

  <table class="table table-striped">
    <thead><th class="pl-4">File</th><th>Size</th><th>Content type</th><th class="text-right pr-4">Records</th></thead>
    <tbody>
    <% stream.uploads.each_with_index do |upload, ix| %>
        <% upload.files.each do |file| %>
          <tr>
            <td class="pl-4"><%= link_to file.filename, download_url(file) %></td>
            <td><%= number_to_human_size file.byte_size %></td>
            <td><%= file.content_type %></td>
            <td class="pr-4 text-right"><%= file.metadata['count'] ? number_with_delimiter(file.metadata['count']) : '???' %></td>
          </tr>
        <% end %>
    <% end %>
    </tbody>
  </table>
</div>

<% if stream.normalized_dumps.last %>
  <div class="card mt-5">
    <div class="card-header d-flex justify-content-between">
      <h3 class="h5 align-self-center mb-0">Normalized data</h3>
    </div>

    <table class="table table-striped">
      <thead><th></th><th class="pl-4">File</th><th>Size</th><th>Created at</th><th class="text-right pr-4">Records</th></thead>
      <tbody>
        <% stream.normalized_dumps.last.full_dump_binary.attachments.each do |attachment| %>
          <tr>
            <th><span class="badge badge-primary">Full</span></th>
            <td class="pl-4"><%= link_to attachment.filename, download_url(attachment) %></td>
            <td><%= number_to_human_size attachment.byte_size %></td>
            <td><%= l attachment.created_at %></td>
            <td></td>
          </tr>
        <% end %>
        <% stream.normalized_dumps.last.full_dump_xml.attachments.each do |attachment| %>
          <tr>
            <th><span class="badge badge-primary">Full</span></th>
            <td class="pl-4"><%= link_to attachment.filename, download_url(attachment) %></td>
            <td><%= number_to_human_size attachment.byte_size %></td>
            <td><%= l attachment.created_at %></td>
            <td></td>
          </tr>
        <% end %>
        <% stream.normalized_dumps.last.delta_dump_binary.attachments.each do |attachment| %>
          <tr>
            <th><span class="badge badge-secondary">Delta</span></th>
            <td class="pl-4"><%= link_to attachment.filename, download_url(attachment) %></td>
            <td><%= number_to_human_size attachment.byte_size %></td>
            <td><%= l attachment.created_at %></td>
            <td></td>
          </tr>
        <% end %>
        <% stream.normalized_dumps.last.delta_dump_xml.attachments.each do |attachment| %>
          <tr>
            <th><span class="badge badge-secondary">Delta</span></th>
            <td class="pl-4"><%= link_to attachment.filename, download_url(attachment) %></td>
            <td><%= number_to_human_size attachment.byte_size %></td>
            <td><%= l attachment.created_at %></td>
            <td></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% end %>
